#+title: Project Status

This page tracks the progress of this project. It may not be up-to-date.

* Emacs Subroutines

Emacs approximately has ~1800 built-in subroutines in C:

#+name: total
#+begin_src bash
  grep -r '^DEFUN ("' ../elisp/emacs/src/*.c | wc --lines
#+end_src

#+RESULTS: total
: 1798

These subroutines are implemented by (at least) ~100 C files:

#+name: c-files
#+begin_src bash
  grep -lr '^DEFUN ("' ../elisp/emacs/src/*.c | wc --lines
#+end_src

#+RESULTS: c-files
: 105

* Juicemacs Subroutines

Subroutines in Juicemacs were generated by =emacs-extractor= with placehholder
code like =throw new UnsupportedOperationException()=. The following code tracks
how many subroutines has been generated and how many are actually implemented
and filled with actual code:

#+begin_src elisp
  (defvar juicemacs-elisp-src-path
    "../elisp/src/main/java/party/iroiro/juicemacs/elisp/")
  (defvar juicemacs-builtin-forms-wildcard
    "forms/BuiltIn*.java")

  (defvar juicemacs-builtin-annotation-regexp
    "^    @ELispBuiltIn(name = \"\\(.+?\\)\"")
  (defun next-annotation ()
    (when (re-search-forward juicemacs-builtin-annotation-regexp nil t)
      (match-string 1)))
  (defun try-search-in-range (pattern start end)
    (save-excursion
      (goto-char start)
      (re-search-forward pattern end t)))

  (defun extract-subroutine-stats ()
    (let ((case-fold-search nil)
          (files (file-expand-wildcards
                  (file-name-concat
                   juicemacs-elisp-src-path
                   juicemacs-builtin-forms-wildcard)))
          start end prev next implemented todos)
      (dolist (file files)
        (with-temp-buffer
          (setq start nil)
          (insert-file-contents file)
          (goto-char (point-min))
          (setq prev (next-annotation)
                start (point))
          (while prev
            (setq next (next-annotation))
            (setq end (point))
            (if (or (try-search-in-range "UnsupportedOperationException"
                                         start end)
                    (try-search-in-range "TODO"
                                         start end))
                (push prev todos)
              (push prev implemented))
            (setq start end
                  prev next))))
      (list implemented todos files)))
#+end_src

#+RESULTS:
: extract-subroutine-stats

#+begin_src elisp :var total=total c-files=c-files
  (pcase-let* ((`(,impls ,todos ,files) (extract-subroutine-stats))
               (impl-count (length impls))
               (todo-count (length todos))
               (file-count (length files)))
    `(("" "Implemented" "Remaining" "Total" "Files")
      ("GNU Emacs" ,total 0 ,total ,c-files)
      ("Juicemacs" ,impl-count ,todo-count ,(+ impl-count todo-count) ,file-count)))
#+end_src

#+RESULTS:
|           | Implemented | Remaining | Total | Files |
| GNU Emacs |        1798 |         0 |  1798 |   105 |
| Juicemacs |         427 |       846 |  1273 |    47 |
